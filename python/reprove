import os
import datetime
import subprocess

from atlassian import Confluence

confluence = Confluence(url="https://confluence.waves.com:8443", username="Tomco", password="Neta201020@")
os.chdir("/System/Volumes/Data/Users/Shared/commits/beta/V12/svn")


update = "svn update"
subprocess.Popen(update.split(), stdout=subprocess.PIPE)
revision = "svn info | grep Revision | grep -oh [0-9][0-9][0-9]"
output = subprocess.getoutput(revision)
real_print_list = list()
current = int(output)
last = current - 30
for num in range(last, current + 1):
    lines = "svn log | grep " + str(num) + " | grep -oh '[0-9] line' | grep -oh '[0-9]'"
    output_for_line = subprocess.getoutput(lines)
    if output_for_line == "1":
        output_for_line = str(2)
        real = "svn log | grep " + str(num) + " -A " + output_for_line
    else:
        real = "svn log | grep " + str(num) + " -A " + output_for_line

    real_print = subprocess.getoutput(real)
    real_print_list.append(real_print + "  \n")
real_print_list = ''.join(real_print_list)
real_print_list = real_print_list.split('\n')

status = confluence.update_page(
    parent_id=None,
    page_id=66945370,
    title="RepoRev ",
    body=real_print_list,
)

print(status)
